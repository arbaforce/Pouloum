<!DOCTYPE html>
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
        <link rel='stylesheet' type='text/css' href='STYLE/newhtml.css'>
        <link rel='stylesheet' type='text/css' href='STYLE/profile_edition.css'>
    </head>
    <body>
        <div id="wrapper" class="container-fluid">
            <div id="container_navbar_and_alert" class="container-fluid mt-1" style="height: 15vh">
                <div id="row_containing_navbar" class="row h-50">
                    <div id="main_navbar" class="navbar navbar-expand-lg navbar-light bg-light h-100 w-100">
                        <div id="navbar_row_containing_columns" class="row h-100 w-100">
                            <div id="navbar_brand_column" class="col-2 h-100">
                                <a class="navbar-brand text-center" href="home_page.html">
                                    P <!-- TODO replace by company logo -->
                                </a>
                            </div><!--#navbar_brand_column-->
                            <div id="navbar_ul_column" class="col-10 h-100">
                                <ul class="navbar-nav mx-auto h-100">
                                    <li class="col-2 nav-item active">
                                        <a class="nav-link font-weight-bold text-center" href="home_page.html">
                                            Accueil
                                        </a>
                                    </li>
                                    <li class="col-2 nav-item dropdown active">
                                        <a class="nav-link dropdown-toggle font-weight-bold text-center" href="#" id="navbar_profile_dropdown_links" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            Profil
                                        </a>
                                        <div class="dropdown-menu" aria-labelledby="navbar_profile_dropdown_links">
                                            <a class="dropdown-item font-weight-bold text-center" href="my_profile.html">Mon Profil</a>
                                            <a class="dropdown-item font-weight-bold text-center" href="profile_history.html">Historique</a>
                                            <a class="dropdown-item font-weight-bold text-center" href="profile_relations.html">Relations</a>
                                        </div>
                                    </li>
                                    <li class="col-2 nav-item active">
                                        <a class="nav-link font-weight-bold text-center" href="events_browser.html">
                                            Chercher
                                        </a>
                                    </li>
                                    <li class="col-2 nav-item dropdown active">
                                        <a class="nav-link dropdown-toggle font-weight-bold text-center" href="#" id="navbar_profile_dropdown_links" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            Organiser
                                        </a>
                                        <div class="dropdown-menu" aria-labelledby="navbar_organize_dropdown_links">
                                            <a class="dropdown-item font-weight-bold text-center" href="modify_event.html?create=1&idEvent=null">Nouvel Evènement</a>
                                            <a class="dropdown-item font-weight-bold text-center" href="modify_event.html?create=0">Modifier</a>
                                        </div>
                                    </li>
                                    <li class="col-2 nav-item active">
                                        <a class="nav-link font-weight-bold text-center" href="activities_browser.html">
                                            Activités
                                        </a>
                                    </li>
                                    <li class="col-2 nav-item active">
                                        <a class="nav-link px-0 py-0 h-100 w-100 text-center" href=" index.html">
                                            <img id="navbar_img" src="IMG/navbar_logout_icon.png" class="img-fluid align-middle">
                                        </a>
                                    </li>
                                </ul>
                            </div><!--#navbar_ul_column-->
                        </div><!--#navbar_row_containing_columns-->
                    </div>  <!--#main_nabar -->
                </div> <!--#row_containing_navbar-->
            </div> <!--#container_navbar_and_alert -->
            
            <div class="row justify-content-center">
                <div class="col-6">
                    <div class="alert alert-danger text-center collapse" id="errorMessage">
                    </div><!--#Error message -->
                </div>
            </div>
            
            <div id="row_containing_modifications" class="row">
                <div id="avatar_container" class="col-4">
                    <div id="image_avatar_row" class="row justify-content-center">
                        <div id="avatar_conainer" class="col-8">
                            <img src="https://static.lexpress.fr/medias_11568/w_2048,h_1146,c_crop,x_0,y_160/w_480,h_270,c_fill,g_north/v1509975901/panda-chine_5923268.jpg" alt="image" class="big_avatar_image rounded fit-image image-responsive" />
                        </div>
                    </div><!--image_avatar_container -->
                    <div id="modify_avatar_link" class="textAlign">
                        Modifier avatar
                    </div><!--modify_avatar_link -->
                </div><!--avatar_container -->
                <div id="left_information_container" class="col-4 justify-content-between">
                    <div id="pseudo_row" class="row">
                        <div class="col-6 text-right">
                            Pseudonyme : 
                        </div>
                        <div class="col-6 text-left">
                            <input type="text" id="user_pseudo_container" class="form-control">
                        </div>
                    </div>
                    <br>
                    <div id="name_row" class="row">
                        <div class="col-6 text-right">
                            Nom : 
                        </div>
                        <div class="col-6 text-left">
                            <input type="text" id="user_name_container" class="form-control">
                        </div>
                    </div>
                    <br>
                    <div id="surname_row" class="row">
                        <div class="col-6 text-right">
                            Prénom : 
                        </div>
                        <div class="col-6 text-left">
                            <input type="text" id="user_surname_container" class="form-control">
                        </div>
                    </div>
                    <br>
                    <div id="Gender_row" class="row">
                        <div class="col-6 text-right">
                            Genre : 
                        </div>
                        <div class="col-6">
                            <label class="radio-inline"><input type="radio" name="gender"  id="masculin">M</label>
                            <label class="radio-inline"><input type="radio" name="gender" id="feminin">F</label>
                        </div>
                    </div>
                    <br>
                    <div id="birthdate_row" class="row">
                        <div class="col-6 text-right">
                            Date de naissance : 
                        </div>
                        <div class="col-6">
                            <input class="form-control" id="user_birthdate_container" name="date" placeholder="DD/MM/YYYY" type="text"/>
                        </div>
                    </div>
                    <br>
                    <div id="phone_number_row" class="row">
                        <div class="col-6 text-right">
                            Téléphone : 
                        </div>
                        <div class="col-6 text-left">
                            <input type="text" id="user_phone_number_container" class="form-control">
                        </div>
                    </div>
                </div><!--left_information_container -->
                <div id="right_information_container" class="col-4 justify-content-between">
                    <div id="mail_row" class="row">
                        <div class="col-6 text-right">
                            Adresse mail : 
                        </div>
                        <div class="col-6 text-left">
                            <input type="text" id="user_mail_container" class="form-control">
                        </div>
                    </div>
                    <br>
                    <div id="password_row" class="row">
                        <div class="col-6 text-right">
                            Mot de passe : 
                        </div>
                        <div class="col-6 text-left">
                            <input type="password" id="user_password_container" class="form-control">
                        </div>
                    </div>
                    <br>
                    <div id="country_row" class="row">
                        <div class="col-6 text-right">
                            Pays : 
                        </div>
                        <div class="col-6 text-left">
                            <input type="text" id="user_address_country_container" class="form-control">
                        </div>
                    </div>
                    <br>
                    <div id="city_row" class="row">
                        <div class="col-6 text-right">
                            Ville : 
                        </div>
                        <div class="col-6 text-left">
                            <input type="text" id="user_address_city_container" class="form-control">
                        </div>
                    </div>
                    <br>
                    <div id="postal_number_row" class="row">
                        <div class="col-6 text-right">
                            Code postal : 
                        </div>
                        <div class="col-6 text-left">
                            <input type="text" id="user_address_postal_number_container" class="form-control">
                        </div>
                    </div>
                    <br>
                    <div id="address_row" class="row">
                        <div class="col-6 text-right">
                            Adresse : 
                        </div>
                        <div class="col-6 text-left">
                            <input type="text" id="user_address_details_container" class="form-control">
                        </div>
                    </div>
                </div><!--right_information_container -->
            </div><!--row_containing_modifications -->
            <br>
            <br>
            <div id="row_validation_buttons" class="row justify-content-end">
                <div class="col-2" id ="validate_button_col">
                    <button id="validate_button" type="button" class="btn btn-light button" >
                        Valider modifications
                    </button><!--#validate_button -->
                </div>
                <div class="col-2" id ="cancel_button_col">
                    <button id="cancel_button" type="button" class="btn btn-light button" onclick="window.location.href = 'profile_edition.html';">
                        Annuler
                    </button><!--#cancel_button -->
                </div>
            </div>
        </div><!--#wrapper-->
        
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
        <script src="SCRIPT/util_scripts.js"></script>
        
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css"/>
                
        <script>
            $(document).ready(function() {
                userID = $.getCookie('userID');
                
                if (userID===""){
                    window.location.href = './index.html'
                }
                
                $.ajax({
                    url: './AjaxAction',
                    type: 'POST',
                    data: {
                        'action': 'getUserDetails',
                        'id': userID
                    },
                    datatype: 'json'
                }).done(function (data){
                    var OK = data.result;
                    if(OK){
                        document.getElementById("user_pseudo_container").value = data.userDetails.nickname;
                        document.getElementById("user_surname_container").value = data.userDetails.first_name;
                        document.getElementById("user_name_container").value = data.userDetails.last_name;
                        document.getElementById("user_birthdate_container").value = data.userDetails.birth_date;
                        document.getElementById("user_mail_container").value = data.userDetails.email;
                        document.getElementById("user_phone_number_container").value = data.userDetails.phone_number;
                        document.getElementById("user_address_country_container").value = data.userDetails.address.country;
                        document.getElementById("user_address_city_container").value = data.userDetails.address.city;
                        document.getElementById("user_address_postal_number_container").value = data.userDetails.address.postal_code;
                        document.getElementById("user_address_details_container").value = data.userDetails.address.number + " " + data.userDetails.address.street;
                        
                        if(data.userDetails.gender==="M"){
                            document.getElementById("masculin").checked = true;
                            document.getElementById("feminin").checked = false;
                        }
                    }
                });
                
                var date_input=$('input[name="date"]'); //our date input has the name "date"
                var container=$('.bootstrap-iso form').length>0 ? $('.bootstrap-iso form').parent() : "body";
                date_input.datepicker({
                    format: 'dd/mm/yyyy',
                    container: container,
                    todayHighlight: true,
                    autoclose: true,
                });
            });
            
            $(function () {
                $("#validate_button").button().on("click", function(){
                    var genderResult;
                    if (document.getElementById("masculin").checked)
                        genderResult = "M";
                    else
                        genderResult = "F";
                    $.ajax({
                        url: './AjaxAction',
                        type: 'POST',
                        data: {
                            'action': 'updateUserDetails',
                            'id': userID,
                            'surname' : $("#user_surname_container").val(),
                            'name' : $("#user_name_container").val(),
                            'pseudo' : $("#user_pseudo_container").val(),
                            'password' : $("#user_password_container").val(),
                            'birthdate' : $("#user_birthdate_container").val(),
                            'mail' : $("#user_mail_container").val(),
                            'phone_number' : $("#user_phone_number_container").val(),
                            'country' : $("#user_address_country_container").val(),
                            'city' : $("#user_address_city_container").val(),
                            'postal_number' : $("#user_address_postal_number_container").val(),
                            'address' : $("#user_address_details_container").val(),
                            'gender' : genderResult
                        },
                        datatype: 'json'
                    }).done(function (data){
                        if(data.result)
                            window.location.href = './my_profile.html';
                        else{
                            $("#errorMessage").show();
                            $("#errorMessage").text(data.errorMessage);
                        }
                    }).fail(function () {
                        $("#errorMessage").show();
                        $("#errorMessage").text("Une erreur est survenue, veuillez réessayer plus tard.");
                    });
                });
            });
        </script>
    </body>
</html>
