<!DOCTYPE html>
<html lang="fr">
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
        <link rel='stylesheet' type='text/css' href='STYLE/newhtml.css'>
        <link rel='stylesheet' type='text/css' href='STYLE/profile_edition.css'>
    </head>
    <body>
        <div id="wrapper" class="container-fluid">
            <div id="container_navbar_and_alert" class="container-fluid" style="max-height: 16vh">
                <div id="container_navbar_row" class="row mx-0">
                    <script src="SCRIPT/navbar_template.js"></script>
                </div>
                <div id="container_alert_row" class="row mx-0 w-100">
                </div>
            </div> <!--#container_navbar_and_alert -->
            
            <div id="row_containing_title" class="row justify-content-center">
                <div class="col-6">
                    <h2 class="textAlign">Modifier profil</h2>
                </div>
            </div>
            
            <div id="row_containing_error" class="row justify-content-center">
                <div class="col-6">
                    <div class="alert alert-danger text-center collapse" id="errorMessage">
                    </div><!--#Error message -->
                </div>
            </div>
            
            <div id="row_containing_modifications" class="row">
                <div id="avatar_container" class="col-4">
                    <div id="image_avatar_row" class="row justify-content-center">
                        <div id="avatar_container_2" class="col-8">
                            <img src="https://static.lexpress.fr/medias_11568/w_2048,h_1146,c_crop,x_0,y_160/w_480,h_270,c_fill,g_north/v1509975901/panda-chine_5923268.jpg" alt="image" class="big_avatar_image rounded fit-image image-responsive" />
                        </div>
                    </div><!--image_avatar_container -->
                    <div id="modify_avatar_link" class="textAlign">
                        Modifier avatar
                    </div><!--modify_avatar_link -->
                </div><!--avatar_container -->
                <div id="left_information_container" class="col-4 justify-content-between">
                    <div id="pseudo_row" class="row">
                        <div class="col-6 text-right">
                            Pseudonyme : 
                        </div>
                        <div class="col-6 text-left">
                            <input type="text" id="user_pseudo_container" class="form-control">
                        </div>
                    </div>
                    <br>
                    <div id="name_row" class="row">
                        <div class="col-6 text-right">
                            Nom : 
                        </div>
                        <div class="col-6 text-left">
                            <input type="text" id="user_name_container" class="form-control">
                        </div>
                    </div>
                    <br>
                    <div id="surname_row" class="row">
                        <div class="col-6 text-right">
                            Prénom : 
                        </div>
                        <div class="col-6 text-left">
                            <input type="text" id="user_surname_container" class="form-control">
                        </div>
                    </div>
                    <br>
                    <div id="Gender_row" class="row">
                        <div class="col-6 text-right">
                            Genre : 
                        </div>
                        <div class="col-6">
                            <label class="radio-inline"><input type="radio" name="gender"  id="masculin">M</label>
                            <label class="radio-inline"><input type="radio" name="gender" id="feminin">F</label>
                        </div>
                    </div>
                    <br>
                    <div id="birthdate_row" class="row">
                        <div class="col-6 text-right">
                            Date de naissance : 
                        </div>
                        <div class="col-6">
                            <input class="form-control" id="user_birthdate_container" name="date" placeholder="DD/MM/YYYY" type="text"/>
                        </div>
                    </div>
                    <br>
                    <div id="phone_number_row" class="row">
                        <div class="col-6 text-right">
                            Téléphone : 
                        </div>
                        <div class="col-6 text-left">
                            <input type="text" id="user_phone_number_container" class="form-control">
                        </div>
                    </div>
                </div><!--left_information_container -->
                <div id="right_information_container" class="col-4 justify-content-between">
                    <div id="mail_row" class="row">
                        <div class="col-6 text-right">
                            Adresse mail : 
                        </div>
                        <div class="col-6 text-left">
                            <input type="text" id="user_mail_container" class="form-control">
                        </div>
                    </div>
                    <br>
                    <div id="password_row" class="row">
                        <div class="col-6 text-right">
                            Mot de passe : 
                        </div>
                        <div class="col-6 text-left">
                            <input type="password" id="user_password_container" class="form-control">
                        </div>
                    </div>
                    <br>
                    <div id="country_row" class="row">
                        <div class="col-6 text-right">
                            Pays : 
                        </div>
                        <div class="col-6 text-left">
                            <input type="text" id="user_address_country_container" class="form-control">
                        </div>
                    </div>
                    <br>
                    <div id="city_row" class="row">
                        <div class="col-6 text-right">
                            Ville : 
                        </div>
                        <div class="col-6 text-left">
                            <input type="text" id="user_address_city_container" class="form-control">
                        </div>
                    </div>
                    <br>
                    <div id="postal_number_row" class="row">
                        <div class="col-6 text-right">
                            Code postal : 
                        </div>
                        <div class="col-6 text-left">
                            <input type="text" id="user_address_postal_number_container" class="form-control">
                        </div>
                    </div>
                    <br>
                    <div id="address_row" class="row">
                        <div class="col-6 text-right">
                            Adresse : 
                        </div>
                        <div class="col-6 text-left">
                            <input type="text" id="user_address_details_container" class="form-control">
                        </div>
                    </div>
                </div><!--right_information_container -->
            </div><!--row_containing_modifications -->
            <br>
            <br>
            <div id="row_validation_buttons" class="row justify-content-end">
                <div class="col-2" id ="validate_button_col">
                    <button id="validate_button" type="button" class="btn btn-light button" >
                        Valider modifications
                    </button><!--#validate_button -->
                </div>
                <div class="col-2" id ="cancel_button_col">
                    <button id="cancel_button" type="button" class="btn btn-light button" onclick="window.location.href = 'my_profile.html';">
                        Annuler
                    </button><!--#cancel_button -->
                </div>
            </div>
        </div><!--#wrapper-->
        
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
        <script src="SCRIPT/util_scripts.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
        <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css"/>
        
        <script>
var date_input=$('input[name="date"]'); //our date input has the name "date"
var container=$('.bootstrap-iso form').length>0 ? $('.bootstrap-iso form').parent() : "body";
date_input.datepicker({
    format: 'dd/mm/yyyy',
    container: container,
    todayHighlight: true,
    autoclose: true,
});
        </script>
        
        <script>
var global_userID = -1;

// gets called automatically
// once the userID is retrieved
function ready_userID(userID) {
    global_userID = userID;
    
    $.ajax({
        url: './AjaxAction',
        type: 'POST',
        data: {
            'action': 'getUserDetails',
            'id': userID
        },
        datatype: 'json'
    }).done(function (data){
        var OK = data.result;
        if (OK) {
            document.getElementById("user_pseudo_container").value = data.userDetails.nickname;
            document.getElementById("user_surname_container").value = data.userDetails.first_name;
            document.getElementById("user_name_container").value = data.userDetails.last_name;
            document.getElementById("user_birthdate_container").value = data.userDetails.birth_date;
            document.getElementById("user_mail_container").value = data.userDetails.email;
            document.getElementById("user_phone_number_container").value = data.userDetails.phone_number;
            document.getElementById("user_address_country_container").value = data.userDetails.address.country;
            document.getElementById("user_address_city_container").value = data.userDetails.address.city;
            document.getElementById("user_address_postal_number_container").value = data.userDetails.address.postal_code;
            document.getElementById("user_address_details_container").value = data.userDetails.address.number + " " + data.userDetails.address.street;
            
            if (data.userDetails.gender == "M") {
                document.getElementById("masculin").checked = true;
                document.getElementById("feminin").checked = false;
            }
        }
    });
}

$(function () {
    $("#validate_button").button().on("click", function() {
        var userID = global_userID;
        if (userID < 0) return;
        
        var genderResult = null;
        if (document.getElementById("masculin").checked)
            genderResult = "M";
        else if (document.getElementById("feminin").checked)
            genderResult = "F";
        $.ajax({
            url: './AjaxAction',
            type: 'POST',
            data: {
                'action': 'updateUserDetails',
                'id': userID,
                'surname' : $("#user_surname_container").val(),
                'name' : $("#user_name_container").val(),
                'pseudo' : $("#user_pseudo_container").val(),
                'password' : $("#user_password_container").val(),
                'birthdate' : $("#user_birthdate_container").val(),
                'mail' : $("#user_mail_container").val(),
                'phone_number' : $("#user_phone_number_container").val(),
                'country' : $("#user_address_country_container").val(),
                'city' : $("#user_address_city_container").val(),
                'postal_number' : $("#user_address_postal_number_container").val(),
                'address' : $("#user_address_details_container").val(),
                'gender' : genderResult
            },
            datatype: 'json'
        }).done(function (data){
            if(data.result)
                window.location.href = './my_profile.html';
            else{
                $("#errorMessage").show();
                $("#errorMessage").text(data.errorMessage);
            }
        }).fail(function () {
            $("#errorMessage").show();
            $("#errorMessage").text("Une erreur est survenue, veuillez réessayer plus tard.");
        });
    });
});
        </script>
        <!-- retrieves the userID -->
        <script src="SCRIPT/userid.js"></script>
        <!-- this script should be put at the very end -->
    </body>
</html>
