<!DOCTYPE html>
<html lang="fr">
    <head>
        <title>Recherche</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
        <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"/>
        <link rel='stylesheet' type='text/css' href='STYLE/newhtml.css'>
        <link rel='stylesheet' type='text/css' href='STYLE/events_browser.css'>
    </head>
    <body>
        
        <div id="wrapper" class="container-fluid">
            <div id="container_navbar_and_alert" class="container-fluid mt-1" style="height: 15vh">
                <script src="SCRIPT/navbar_template.js"></script>
            </div> <!--#container_navbar_and_alert -->
            
            <div id="search_band_global_container" class="container">
                <div id="search_band_row" class="row border padding10down ">
                    <div id="first_row_search_band_container" class="container">
                        <div id="first_row_search_band" class="row w-100">
                            <div id="activity_filter_col" class="col-6"> 
                                <div id="activity_filter_container" class="container">
                                    <div class="row w-100 justify-content-center">
                                        <div class="col-3 padding10up">
                                            <label for="activity_filter">Activité :</label>
                                        </div>
                                        <div class="col-5 padding10up">
                                            <input type="text" class="form-control" id="activity_filter">
                                        </div>
                                    </div>
                                </div><!--#activity_filter_container -->
                            </div><!--#activity_filter_col -->
                            <div id="localisation_filter_col" class="col-6">
                                <div id="localisation_filter_container">
                                    <div class="row w-100 justify-content-center">
                                        <div class="col-3 padding10up">
                                            <label for="localisation_filter">Localisation :</label>
                                        </div>
                                        <div class="col-5 padding10up">
                                            <input type="text" class="form-control" id="localisation_filter">
                                        </div>
                                    </div>
                                </div><!--#localisation_filter_container -->
                            </div><!--#localisation_filter_col -->
                        </div><!--#first_row_search_band -->
                    </div><!--#first_row_search_band_container -->
                    <div id="second_row_search_band_container" class="container">
                        <div id="second_row_search_band_row" class="row w-100">
                            <div id="date_filter_col" class="col-6 padding10up"> 
                                <div id="date_filter_container" class="container">
                                    <div class="row w-100 justify-content-center">
                                        <div class="col-3">
                                            <label for="date_filter">Date :</label>
                                        </div>
                                        <div class="col-5">
                                            <input type="text" class="form-control" id="date_filter">
                                        </div>
                                    </div>
                                </div><!--#date_filter_container -->
                            </div><!--#date_filter_col -->
                            <div id="friend_filter_col" class="col-6 padding10up">
                                <div id="friend_filter_container" class="container">
                                    <div class="row w-100 justify-content-center">
                                        <div class="col-3">
                                            <label for="friend_filter">Ami participant :</label>
                                        </div>
                                        <div class="col-5">
                                            <input type="text" class="form-control" id="friend_filter">
                                        </div>
                                    </div>
                                </div><!--#friend_filter_container -->
                            </div><!--#friend_filter_col -->
                        </div><!--#second_row_search_band_row -->
                    </div><!--#second_row_search_band_container -->
                </div><!--#search_band_row -->
            </div><!--#search_band_global_container -->
            
            
            <div id="search_result_global_container" class="container w-100">
                <div id="search_result_global_row" class="row h-100 w-100 mx-0 my-0 px-0 py-0" >
                    <div id="search_result_list_global_col" class="col h-100 w-100 px-0 py-0">
                        <div id="search_result_list_global_container" class="container h-100 w-100">
                          
                            
                        </div><!--#search_result_list_global_container -->
                    </div><!--#search_result_list_global_col -->
                    <div id="search_result_map_global_col" class="col sidebar ">
                        <div id="search_result_map_global_container" class="container h-100 w-100">
                            <div id="map_container" class="container">
                                <div id="map" class="h-100 w-100">
                                    
                                </div>
                            </div>
                            <button id="map_Button" class="map_Button_Sidebar btn" onclick="openNav()">
                                Map
                            </button>  
                        </div><!--#search_result_map_global_container -->
                    </div><!--#search_result_map_global_col -->
                </div><!--#search_result_global_row -->
            </div><!--#search_result_global_container -->
            
        </div><!--#wrapper-->
        
        
        <script src="SCRIPT/map.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
        <script src="SCRIPT/events_browser.js"></script>
        
        <script>
initialiseMap();

$.ajax({
    url: './AjaxAction',
    type: 'POST',
    data: {
        'action': 'getUserIdSession',
    },
    datatype: 'json'
}).done(function (data){
    if(data.result){
        userID = data.userID;
    }
    else {
        window.location.href = './index.html';
    }
});
        </script>
        <script type="text/javascript">
// addResultDemo();

$(document).ready(function() {
    $.ajax({
        url: './AjaxAction',
        type: 'POST',
        data: {
            'action': 'getAllEvents',
         // 'id': userID
        },
        datatype: 'json'
    }).fail(function (data) {
        console.log("*** FAIL ***");
    }).done(function (data) {
        var OK = data.result;
        if (OK == "false") {
            console.log("*** FAIL ***");
        } else {
            var events = data.events;
            var count = 0;
            for (var i=0; i<events.length; i++) {
                var event = events[i];
                
                var data_id = event.id;
                var data_label = event.label;
                /// data_description = event.description;
                /// data_p_min = event.participants_min;
                /// data_p_max = event.participants_max;
                
                // var data_cancelled = event.cancelled;
                // console.log(data_cancelled);
                // if (data_cancelled) continue;
                
                var tmp_a = event.activity;
                var data_activities = [{
                    name: tmp_a.name,
                    url: "./activity_details?id=" + tmp_a.id,
                    level: "débutant" //FIXME
                }];
                var tmp_bs = tmp_a.badges;
                var data_badges = [];
                for (var i=0; i<tmp_bs.length; i++) {
                    var tmp_b = tmp_bs[i];
                    var name = tmp_b.type + " ";
                    name = name.charAt(0).toUpperCase() + name.slice(1).toLowerCase();
                    data_badges.push(name.trim());
                }
                
                var tmp_ps = event.participants;
                var data_participants = [];
                for (var i=0; i<tmp_ps.length; i++) {
                    var tmp_p = tmp_ps[i];
                    data_participants.push({
                        url: "./consult_other_user_profile.html?id=" + tmp_p.id,
                        img: "https://static.lexpress.fr/medias_11568/w_2048,h_1146,c_crop,x_0,y_160/w_480,h_270,c_fill,g_north/v1509975901/panda-chine_5923268.jpg", //FIXME
                        alt: "Profil de " + tmp_p.nickname
                    });
                }
                
                var tmp_o = event.pouloumer;
                var data_organizer = {
                    name: tmp_o.nickname,
                    url: "./consult_other_user_profile.html?id=" + tmp_o.id
                };
                
                var data_place = event.address;
                var data_start = event.startDate;
                var data_duration = event.duration;
                var data_status = event.statut;
                // cancelled | finished | started  | full  | ready | organized
                // annulé    | terminé  | commencé | plein | prêt  | proposé
                var data_eventurl = "";
                
                /*
                var tmp_cs = event.comments;
                console.log("=== COMMENTS ===");
                console.log(tmp_cs);
                */
                
                addResult(data_id, data_label, data_activities, data_organizer, data_place, data_start, data_duration, data_participants, data_status, data_eventurl, data_badges);
                
                count++;
                if (count >= 50) break;
            }
        }
    });
});
        </script>
    </body>
<!--
        obj.add("activity", activity.toJson());
        obj.add("pouloumer", organizer.toJson());

        JsonArray participantsArray = new JsonArray();
        for (Pouloumer p : participants) {
            participantsArray.add(p.toJson());
        }
        obj.add("participants", participantsArray);

        JsonArray commentsArray = new JsonArray();
        for (Comment c : comments) {
            commentsArray.add(c.toJson());
        }
        obj.add("comments", commentsArray);

        return obj;
-->
</html>
